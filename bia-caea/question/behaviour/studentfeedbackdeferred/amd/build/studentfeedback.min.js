define(["jquery","core/url","core/config","core/log"],function(a,b,c,d){function e(c,e){var f=a("#"+c+" .feedback-area"),g=a("#"+c+" .submit-feedback"),h=a("#"+c+" .cancel-feedback"),i=a("#"+c+" .edit-feedback"),j=function(a){i.toggle(!a),g.toggle(a),h.toggle(a&&f.is(".populated")),a?f.removeAttr("disabled"):f.attr("disabled","disabled")},k=function(a){a.preventDefault(),a.returnValue=""};f.change(function(){window.addEventListener("beforeunload",k)}),j(!f.is(".populated")||f.val()!=f.data("value")),g.click(function(){a.ajax({url:b.relativeUrl("/question/behaviour/studentfeedbackdeferred/ajax/submitstudentfeedback.json.php"),async:!1,dataType:"json",data:a.extend({},{feedback:encodeURIComponent(f.val())},e),method:"post"}).done(function(a){a.success?(f.data("value",f.val()),f.addClass("populated"),j(!1),window.removeEventListener("beforeunload",k)):d.error(a.error)}).fail(d.error)}),i.click(function(){j(!0)}),h.click(function(){f.val(f.data("value")),j(!1),window.removeEventListener("beforeunload",k)})}return{setupForQuestion:function(a,b){e(a,{qasid:b,sesskey:c.sesskey,isgeneral:0})},setupForQuiz:function(a,b){e(a,{qasid:b,sesskey:c.sesskey,isgeneral:1})}}});
//# sourceMappingURL=studentfeedback.min.js.map