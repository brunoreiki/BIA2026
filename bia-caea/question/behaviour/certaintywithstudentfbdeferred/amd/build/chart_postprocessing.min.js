define("qbehaviour_certaintywithstudentfbdeferred/chart_postprocessing",["core/chartjs","qbehaviour_certaintywithstudentfbdeferred/charts_utility"],(function(ChartJS,ChartsUtility){var component="qbehaviour_certaintywithstudentfbdeferred",currentNumForSidebar=-1;return{postprocessing:function(shapes,hasDeclaredIgnorance){ChartJS.defaults.font.size=15,ChartsUtility.executeWhenChartLoaded(component+"_this-attempt-chart",(function(chart){chart.options.scales.x.ticks.display=!1,chart.options.scales.y.ticks.stepSize=1,chart.options.scales.y.title.display=!0,chart.options.scales.y.title.text=M.util.get_string("numofanswers",component),chart.options.elements.point.radius=0,chart.options.elements.point.hoverRadius=0,chart.update();var postProcessThisAttemptChartTable=function(){var table=document.querySelector('[data-role="'+component+'_this-attempt-chart"] .chart-table table');null===table?setTimeout(postProcessThisAttemptChartTable,200):table.querySelectorAll("tr > *:nth-child(n+2):nth-child(-n+3)").forEach((e=>e.remove()))};postProcessThisAttemptChartTable()}));var nattempts=shapes.length;if(!(nattempts<2)){var formatAttemptsProgressChart=function(chart,yMin,yMax,yStep){chart.options.scales.x.title.display=!0,chart.options.scales.x.title.text=M.util.get_string("attemptnumber","mod_quiz"),chart.options.scales.x.offset=!0,chart.options.scales.y.offset=!0,chart.options.scales.y.min=yMin,chart.options.scales.y.max=yMax,chart.options.scales.y.ticks.stepSize=yStep,chart.options.elements.point.radius=10,chart.options.elements.point.hoverRadius=16,chart.data.datasets[0].borderColor="black",chart.data.datasets[0].borderWidth=2,chart.data.datasets[0].pointStyle=shapes},setupTooltipAndSideWindowForChart=function(chart,makeTooltipInfo){chart.options.plugins.tooltip.callbacks.title=function(context){return M.util.get_string("attempt","mod_quiz",context[0].dataIndex+1)},chart.options.plugins.tooltip.callbacks.afterBody=function(context){return makeTooltipInfo(context[0].dataIndex)},chart.options.plugins.tooltip.callbacks.footer=function(){return M.util.get_string("clickfordetails",component)},chart.canvas.onclick=function(evt){var points=chart.getElementsAtEventForMode(evt,"nearest",{intersect:!0},!0);points.length>0&&function(attemptNum){var contentEl=document.querySelector(".charts-content"),sidebarsContainer=document.getElementById("charts-sidebar-container");if(sidebarsContainer.hidden=!0,document.querySelectorAll('[data-role="charts-sidebar"]').forEach((function(sidebar){sidebar.hidden=!0})),currentNumForSidebar==attemptNum)return contentEl.classList.remove("reducedwidth"),void(currentNumForSidebar=-1);currentNumForSidebar=attemptNum,sidebarsContainer.hidden=!1,document.querySelector('[data-role="charts-sidebar"][data-attemptnum="'+attemptNum+'"]').hidden=!1,contentEl.classList.add("reducedwidth")}(points[0].index+1)}},charts={grades:null,lucidity:null},pointsRadiusModified=!0,resetPointsRadius=function(){pointsRadiusModified&&(null!==charts.grades&&(charts.grades.mainDataset.pointRadius=Array(nattempts).fill(10)),null!==charts.lucidity&&(charts.lucidity.mainDataset.pointRadius=Array(nattempts).fill(10)),-1!==currentNumForSidebar?(null!==charts.grades&&(charts.grades.mainDataset.pointRadius[currentNumForSidebar-1]=14),null!==charts.lucidity&&(charts.lucidity.mainDataset.pointRadius[currentNumForSidebar-1]=14),pointsRadiusModified=!0):pointsRadiusModified=!1)};ChartsUtility.executeWhenChartLoaded(component+"_grades-chart",(function(gradesChart){charts.grades={chart:gradesChart,mainDataset:gradesChart.data.datasets[0]},formatAttemptsProgressChart(gradesChart,0,100,10);var declaredIgnoranceDataset=null;hasDeclaredIgnorance&&((declaredIgnoranceDataset=gradesChart.data.datasets[1]).hidden=!0),setupTooltipAndSideWindowForChart(gradesChart,(function(itemIndex){return hasDeclaredIgnorance?M.util.get_string("declaredignoranceratea",component,declaredIgnoranceDataset.data[itemIndex]):""})),gradesChart.options.onHover=function(){if(null!==charts.lucidity){var needUpdate=!1;pointsRadiusModified&&(resetPointsRadius(),needUpdate=!0);var activeElements=arguments[1];1===activeElements.length&&(charts.lucidity.mainDataset.pointRadius[activeElements[0].index]=16,pointsRadiusModified=!0,needUpdate=!0),needUpdate&&(charts.lucidity.chart.update(),gradesChart.update())}},gradesChart.canvas.onmouseout=function(){null!==charts.lucidity&&pointsRadiusModified&&(resetPointsRadius(),charts.lucidity.chart.update(),gradesChart.update())},gradesChart.update()})),ChartsUtility.executeWhenChartLoaded(component+"_lucidity-chart",(function(lucidityChart){charts.lucidity={chart:lucidityChart,mainDataset:lucidityChart.data.datasets[0]},formatAttemptsProgressChart(lucidityChart,-100,100,10);var labelsDataset=lucidityChart.data.datasets[1];labelsDataset.hidden=!0,setupTooltipAndSideWindowForChart(lucidityChart,(function(itemIndex){return labelsDataset.data[itemIndex]})),lucidityChart.options.onHover=function(){if(null!==charts.grades){var needUpdate=!1;pointsRadiusModified&&(resetPointsRadius(),needUpdate=!0);var activeElements=arguments[1];1===activeElements.length&&(charts.grades.mainDataset.pointRadius[activeElements[0].index]=16,pointsRadiusModified=!0,needUpdate=!0),needUpdate&&(charts.grades.chart.update(),lucidityChart.update())}},lucidityChart.canvas.onmouseout=function(){null!==charts.grades&&pointsRadiusModified&&(resetPointsRadius(),charts.grades.chart.update(),lucidityChart.update())},lucidityChart.update()}))}}}}));

//# sourceMappingURL=chart_postprocessing.min.js.map